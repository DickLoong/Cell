# Cell
一个实验项目，探讨为什么当前微服务实践中服务划分成本、调试成本和部署成本会是最大的成本痛点，为什么服务粒度大小自动伸缩能在不引入新成本的前提下降低这些成本，并尝试通过实现一个代码生成套件和服务调用插件，实现一个服务粒度大小的自动化伸缩的微服务架构demo。
## 前言
为什么当前微服务实践中服务划分成本、调试成本和部署成本会是最大的成本痛点？那是因为微服务架构拆分一体化架构成若干子系统，不同系统之间资源相互隔离，不同子系统间通过公共协议通信，来降低不同系统间的耦合度，从而提高系统的整体可用性的同时，这种拆分将导致不可忽视的服务间相互调用的性能成本，于是需要判定拆分的边界是什么，于是产生了新的划分成本；其次，需要调用多个子系统服务的业务将难以像过往那样单机启动断点调试，于是出现了分布式系统下的额外调试成本；再有，不同子系统启动依赖不同的环境，可能需要不同的部署脚本，当子系统数目多起来的时候，将产生新的维护部署脚本等部署资源开发的成本，而这些成本目前很大程度是需要通过人肉来解决的，而人，是计算机系统实现当中最贵且最不可靠的资源，而这三种成本又并不是微服务所要解决的问题的必要成本，于是，这三个成本属于成本痛点，而且花了这个成本还不一定能解决问题。以下将举例说明
### 场景
本人于2015-2016年曾任职于国内一家5000员工量级、注册用户接近一亿量级的电话推销线下场所服务的Z公司。该企业通过内部CRM系统支持日均10W次用户联络和5%转化率的支付流程，同时维护数十个各种数据相互交联的实时报表（2016年数据）。2009-2017年间，该系统是一个一体化架构的系统，业务数据表都在同一个库内，维护该系统的程序员主要是通过sql实现各种功能，不能通过sql实现的需求或者sql很难实现的需求，比如跨机器跨库查询报表或者复杂逻辑报表，则是另外写业务代码来实现不能sql实现的部分，简而言之，业务沉降在数据库层面。产品经理提的需求也很灵活，除了功能需求，新增的报表需求也很多，而且逻辑常常穿透很多层面，比如电话沟通数据关联支付数据关联投诉数据，等等。随着业务发展，该系统分别实现了读写分离和对若该热点表的分表处理以满足需要。在2015年前，此系统核心业务基本保持了99.99%的可靠性。但是，该企业2015-2016年业务量增长了60%以上，新增的业务复杂度和数据量压力导致该系统2015年-2016年的可靠性下降到了99.7%，具体表现为原来需求稳定的业务被新增功能影响至失灵，基于原有基础开发功能也因为数据表文档的缺失难以开展开发工作。此时支持该系统的数据库实例数也已达到了34台，表数量达到了3000个以上（sharding过的表和无sharding的表合在了一起），这么多的机器和表，可靠性却下降了，意味着问题不在性能上。
### 已有的解决方案
在2017-2018期间，该系统经过以下两个改造，可靠性再一次回到了99.99%，分别是引入了自动化测试，以及微服务架构改造，其中微服务架构改造具体过程如下：
1.将原来的一体化应用按照业务组织划分拆成多个小的应用
2.按照应用划分数据库，不同应用之间数据库不能直接sql调用，跨应用数据调用通过接口获取，通过dubbo做服务路由和负载均衡
3.引入storm和kafka，各个应用推送实时数据到storm，实时报表通过storm实现
4.建立应用运维团队，负责各个应用的自动化运维，包括构建、部署、发布等，通过jenkins和docker实现一键集成
### 分析.问题是怎样解决的.将会有什么问题
首先，本项目认为微服务架构提高系统可用性的核心思路是：将一体化系统拆分封装成若干相互独立的子系统相互通信组成的复合系统，通过隔离不同子系统的资源调用来保证计算资源的分配计划不会被系统间耦合破坏。
